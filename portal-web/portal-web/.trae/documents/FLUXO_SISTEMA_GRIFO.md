# üîÑ Fluxo Completo do Sistema Grifo Vistorias

> **Documenta√ß√£o t√©cnica dos fluxos e processos do sistema multi-tenant de gest√£o de vistorias imobili√°rias**

## üìã √çndice

1. [Vis√£o Geral da Arquitetura](#1-vis√£o-geral-da-arquitetura)
2. [Fluxo Completo de Vistoria](#2-fluxo-completo-de-vistoria)
3. [Fluxos de Autentica√ß√£o](#3-fluxos-de-autentica√ß√£o)
4. [Sistema de Contesta√ß√£o](#4-sistema-de-contesta√ß√£o)
5. [Integra√ß√£o entre Componentes](#5-integra√ß√£o-entre-componentes)
6. [Fluxo de Dados e Sincroniza√ß√£o](#6-fluxo-de-dados-e-sincroniza√ß√£o)
7. [Diagramas de Processo](#7-diagramas-de-processo)

---

## 1. Vis√£o Geral da Arquitetura

### 1.1 Arquitetura Multi-Tenant

O Sistema Grifo utiliza uma arquitetura multi-tenant com **isolamento por empresa**, permitindo que m√∫ltiplas empresas de vistoria utilizem a mesma infraestrutura de forma segura e isolada.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SISTEMA GRIFO VISTORIAS                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  TENANT A (Empresa 1)  ‚îÇ  TENANT B (Empresa 2)  ‚îÇ  TENANT C... ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ Portal Admin         ‚îÇ ‚Ä¢ Portal Admin         ‚îÇ ‚Ä¢ Portal...  ‚îÇ
‚îÇ ‚Ä¢ Portal Cliente       ‚îÇ ‚Ä¢ Portal Cliente       ‚îÇ ‚Ä¢ Portal...  ‚îÇ
‚îÇ ‚Ä¢ App Mobile          ‚îÇ ‚Ä¢ App Mobile          ‚îÇ ‚Ä¢ App...     ‚îÇ
‚îÇ ‚Ä¢ Dados Isolados      ‚îÇ ‚Ä¢ Dados Isolados      ‚îÇ ‚Ä¢ Dados...   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   API BACKEND     ‚îÇ
                    ‚îÇ  (Multi-Tenant)   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  SUPABASE DB      ‚îÇ
                    ‚îÇ (PostgreSQL+RLS)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1.2 Componentes Principais

| Componente | Tecnologia | Fun√ß√£o | Porta |
|------------|------------|--------|---------|
| **API Backend** | Node.js + Express | L√≥gica de neg√≥cio e autentica√ß√£o | 3001 |
| **Portal Admin** | Next.js 14 | Interface administrativa | 3000 |
| **Portal Cliente** | Next.js 14 | Interface para clientes | 3000 |
| **App Mobile** | React Native + Expo | Aplicativo para vistoriadores | - |
| **Banco de Dados** | Supabase (PostgreSQL) | Armazenamento com RLS | - |
| **Storage** | Supabase Storage | Arquivos e imagens | - |

### 1.3 Isolamento Multi-Tenant

**Estrat√©gia**: Cada empresa possui um `empresa_id` √∫nico que √© usado para filtrar todos os dados.

**Row Level Security (RLS)**: Pol√≠ticas autom√°ticas garantem que cada tenant s√≥ acesse seus pr√≥prios dados.

```sql
-- Exemplo de pol√≠tica RLS
CREATE POLICY "tenant_isolation" ON vistorias
  FOR ALL USING (
    empresa_id = (auth.jwt() ->> 'empresa_id')::uuid
  );
```

---

## 2. Fluxo Completo de Vistoria

### 2.1 Ciclo de Vida de uma Vistoria

```
[CRIA√á√ÉO] ‚Üí [ATRIBUI√á√ÉO] ‚Üí [EXECU√á√ÉO] ‚Üí [REVIS√ÉO] ‚Üí [ENTREGA] ‚Üí [CONTESTA√á√ÉO?]
```

### 2.2 Fluxo Detalhado

#### **Fase 1: Cria√ß√£o da Solicita√ß√£o**

**Portal do Cliente:**
1. Cliente faz login no portal (`/cliente/login`)
2. Acessa "Nova Solicita√ß√£o" (`/cliente/nova-solicitacao`)
3. Preenche formul√°rio:
   - Endere√ßo do im√≥vel
   - Tipo de vistoria
   - Data preferencial
   - Observa√ß√µes
4. Sistema cria registro na tabela `inspection_requests`
5. Status inicial: `"pendente"`

**Portal Administrativo:**
1. Gestor visualiza solicita√ß√µes em `/solicitacoes`
2. Pode aprovar, rejeitar ou solicitar mais informa√ß√µes
3. Se aprovada, cria vistoria na tabela `vistorias`
4. Status: `"pendente"` ‚Üí `"aprovada"`

#### **Fase 2: Atribui√ß√£o do Vistoriador**

**Portal Administrativo:**
1. Gestor acessa `/vistorias`
2. Seleciona vistoria pendente
3. Atribui vistoriador dispon√≠vel
4. Sistema atualiza `app_vistoriador_id`
5. Status: `"aprovada"` ‚Üí `"atribuida"`
6. Notifica√ß√£o enviada ao vistoriador

#### **Fase 3: Execu√ß√£o da Vistoria**

**App Mobile:**
1. Vistoriador faz login no app
2. Visualiza vistorias atribu√≠das na aba "Vistorias"
3. Seleciona vistoria e inicia execu√ß√£o
4. Status: `"atribuida"` ‚Üí `"em_andamento"`
5. Processo de vistoria:
   - Captura fotos dos ambientes
   - Preenche formul√°rios de avalia√ß√£o
   - Registra observa√ß√µes
   - Coleta coordenadas GPS
6. Dados salvos localmente (offline-first)
7. Sincroniza√ß√£o autom√°tica quando online
8. Finaliza vistoria
9. Status: `"em_andamento"` ‚Üí `"concluida"`

#### **Fase 4: Revis√£o e Aprova√ß√£o**

**Portal Administrativo:**
1. Gestor visualiza vistorias conclu√≠das
2. Revisa relat√≥rio e fotos
3. Pode:
   - Aprovar: Status ‚Üí `"aprovada"`
   - Solicitar corre√ß√µes: Status ‚Üí `"revisao"`
   - Rejeitar: Status ‚Üí `"rejeitada"`

#### **Fase 5: Gera√ß√£o e Entrega do Laudo**

**Sistema Autom√°tico:**
1. Gera PDF do laudo com:
   - Dados da vistoria
   - Fotos organizadas
   - Observa√ß√µes t√©cnicas
   - QR Code para contesta√ß√£o
2. Salva no Supabase Storage
3. Envia notifica√ß√£o ao cliente
4. Status: `"aprovada"` ‚Üí `"entregue"`

#### **Fase 6: Contesta√ß√£o (Opcional)**

**Sistema P√∫blico:**
1. Cliente/interessado acessa link do QR Code
2. P√°gina p√∫blica `/contestar/[token]`
3. Preenche formul√°rio de contesta√ß√£o
4. Upload de evid√™ncias (fotos/documentos)
5. Sistema registra contesta√ß√£o
6. Notifica empresa respons√°vel

---

## 3. Fluxos de Autentica√ß√£o

### 3.1 Autentica√ß√£o de Gestores (Portal Admin)

```
[Login] ‚Üí [Valida√ß√£o] ‚Üí [JWT] ‚Üí [Middleware] ‚Üí [Dashboard]
```

**Processo Detalhado:**

1. **Login** (`/login`):
   ```typescript
   POST /api/v1/auth/portal/login
   {
     "email": "gestor@empresa.com",
     "password": "senha123"
   }
   ```

2. **Valida√ß√£o Backend**:
   - Verifica credenciais na tabela `portal_users`
   - Valida se usu√°rio est√° ativo
   - Verifica empresa associada

3. **Gera√ß√£o JWT**:
   ```javascript
   const token = jwt.sign({
     user_id: user.id,
     empresa_id: user.empresa_id,
     role: user.role,
     permissions: user.permissions
   }, JWT_SECRET);
   ```

4. **Middleware de Prote√ß√£o**:
   ```typescript
   // middleware.ts
   if (!token) redirect('/login');
   if (protectedRoute && !validToken) redirect('/login');
   ```

5. **Acesso ao Dashboard**:
   - Token armazenado em cookie httpOnly
   - Middleware valida em cada requisi√ß√£o
   - RLS filtra dados por empresa

### 3.2 Autentica√ß√£o de Clientes (Portal Cliente)

```
[Registro] ‚Üí [Verifica√ß√£o] ‚Üí [Login] ‚Üí [Sess√£o] ‚Üí [Dashboard]
```

**Processo Detalhado:**

1. **Registro** (`/cliente/registro`):
   ```typescript
   POST /api/clients/register
   {
     "name": "Jo√£o Silva",
     "email": "joao@email.com",
     "password": "senha123",
     "phone": "11999999999"
   }
   ```

2. **Cria√ß√£o de Conta**:
   - Hash da senha com bcrypt
   - Registro na tabela `clients`
   - Cria√ß√£o de sess√£o inicial

3. **Login** (`/cliente/login`):
   ```typescript
   POST /api/clients/login
   {
     "email": "joao@email.com",
     "password": "senha123"
   }
   ```

4. **Sess√£o de Cliente**:
   - Token JWT espec√≠fico para clientes
   - Armazenado em localStorage e cookie
   - Renova√ß√£o autom√°tica

### 3.3 Autentica√ß√£o de Vistoriadores (App Mobile)

```
[Login] ‚Üí [Biometria?] ‚Üí [Token] ‚Üí [Sincroniza√ß√£o] ‚Üí [Offline Cache]
```

**Processo Detalhado:**

1. **Login no App**:
   ```typescript
   POST /api/v1/auth/app/login
   {
     "email": "vistoriador@empresa.com",
     "password": "senha123"
   }
   ```

2. **Valida√ß√£o e Token**:
   - Verifica na tabela `app_users`
   - Gera JWT com permiss√µes espec√≠ficas
   - Inclui empresa_id para isolamento

3. **Cache Offline**:
   - Token salvo no SecureStore
   - Dados essenciais em cache local
   - Biometria para acesso r√°pido

4. **Sincroniza√ß√£o**:
   - Dados locais sincronizados quando online
   - Conflitos resolvidos automaticamente

---

## 4. Sistema de Contesta√ß√£o

### 4.1 Gera√ß√£o do Link de Contesta√ß√£o

```
[Vistoria Conclu√≠da] ‚Üí [Gerar Token] ‚Üí [QR Code] ‚Üí [Incluir no Laudo]
```

**Processo:**

1. **Gera√ß√£o Autom√°tica**:
   ```javascript
   // Quando vistoria √© aprovada
   const contestToken = crypto.randomUUID();
   const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000); // 30 dias
   
   await supabase.from('contest_links').insert({
     vistoria_id: vistoria.id,
     empresa_id: vistoria.empresa_id,
     token: contestToken,
     expires_at: expiresAt
   });
   ```

2. **QR Code no Laudo**:
   - URL: `https://sistema.com/contestar/${token}`
   - QR Code gerado automaticamente
   - Inclu√≠do no PDF do laudo

### 4.2 Fluxo de Contesta√ß√£o

```
[Scan QR] ‚Üí [P√°gina P√∫blica] ‚Üí [Formul√°rio] ‚Üí [Upload] ‚Üí [Notifica√ß√£o]
```

**Processo Detalhado:**

1. **Acesso P√∫blico** (`/contestar/[token]`):
   - P√°gina acess√≠vel sem login
   - Valida√ß√£o do token
   - Verifica√ß√£o de expira√ß√£o

2. **Formul√°rio de Contesta√ß√£o**:
   ```typescript
   {
     "contestant_name": "Maria Silva",
     "contestant_email": "maria@email.com",
     "contestant_phone": "11888888888",
     "reason": "Discordo da avalia√ß√£o do banheiro",
     "description": "O banheiro estava em perfeito estado...",
     "evidence_files": ["foto1.jpg", "documento.pdf"]
   }
   ```

3. **Processamento**:
   - Upload de arquivos para Supabase Storage
   - Registro na tabela `contestations`
   - Marca token como usado
   - Notifica empresa respons√°vel

4. **Notifica√ß√£o √† Empresa**:
   - Email autom√°tico para gestores
   - Notifica√ß√£o no portal administrativo
   - Status da vistoria: `"contestada"`

---

## 5. Integra√ß√£o entre Componentes

### 5.1 API Backend como Hub Central

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Portal Web  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ API Backend ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ App Mobile  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ Supabase DB ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5.2 Comunica√ß√£o entre Componentes

#### **Portal Web ‚Üî API**

```typescript
// lib/api.ts
class ApiService {
  async getInspections(filters) {
    return fetch(`${API_URL}/api/v1/tenants/${tenant}/inspections`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'X-Tenant-ID': tenantId
      }
    });
  }
}
```

#### **App Mobile ‚Üî API**

```typescript
// services/grifoApi.ts
class GrifoApiService {
  async syncInspections() {
    const localData = await getLocalInspections();
    const serverData = await this.getInspections();
    
    // Resolve conflitos e sincroniza
    return await this.mergeData(localData, serverData);
  }
}
```

#### **API ‚Üî Supabase**

```javascript
// Middleware de tenant
const tenantMiddleware = (req, res, next) => {
  const empresaId = req.user.empresa_id;
  req.supabase = supabase.from('vistorias')
    .select('*')
    .eq('empresa_id', empresaId);
  next();
};
```

### 5.3 Fluxo de Dados em Tempo Real

```
[A√ß√£o no App] ‚Üí [API] ‚Üí [Supabase] ‚Üí [Realtime] ‚Üí [Portal Web]
```

**Exemplo - Atualiza√ß√£o de Status:**

1. **App Mobile**: Vistoriador finaliza vistoria
2. **API**: Recebe PUT `/inspections/:id`
3. **Supabase**: Atualiza status na tabela
4. **Realtime**: Notifica subscribers
5. **Portal Web**: Atualiza interface automaticamente

---

## 6. Fluxo de Dados e Sincroniza√ß√£o

### 6.1 Estrat√©gia Offline-First (App Mobile)

```
[A√ß√£o Local] ‚Üí [Cache SQLite] ‚Üí [Queue Sync] ‚Üí [API] ‚Üí [Supabase]
```

**Implementa√ß√£o:**

```typescript
// services/offline.ts
class OfflineService {
  async saveInspection(data) {
    // 1. Salva localmente
    await SQLite.insertInspection(data);
    
    // 2. Adiciona √† fila de sincroniza√ß√£o
    await SyncQueue.add('inspection_update', data);
    
    // 3. Tenta sincronizar se online
    if (await NetInfo.isConnected()) {
      await this.syncPendingChanges();
    }
  }
}
```

### 6.2 Resolu√ß√£o de Conflitos

**Estrat√©gia**: Last-Write-Wins com timestamp

```typescript
const resolveConflict = (local, server) => {
  if (local.updated_at > server.updated_at) {
    return local; // Dados locais mais recentes
  }
  return server; // Dados do servidor mais recentes
};
```

### 6.3 Sincroniza√ß√£o de Arquivos

```
[Foto Capturada] ‚Üí [Compress√£o] ‚Üí [Cache Local] ‚Üí [Upload Supabase] ‚Üí [URL Atualizada]
```

**Processo:**

1. **Captura**: Foto salva localmente
2. **Otimiza√ß√£o**: Compress√£o autom√°tica
3. **Upload**: Quando online, envia para Supabase Storage
4. **Refer√™ncia**: Atualiza URL na base de dados

---

## 7. Diagramas de Processo

### 7.1 Fluxo Completo de Vistoria

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CLIENTE   ‚îÇ
‚îÇ Cria Solic. ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   GESTOR    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  VISTORIA   ‚îÇ
‚îÇ Aprova Solic‚îÇ    ‚îÇ  CRIADA     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ   GESTOR    ‚îÇ
                   ‚îÇ Atribui Vist‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇVISTORIADOR  ‚îÇ
                   ‚îÇ Executa     ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ   GESTOR    ‚îÇ
                   ‚îÇ Revisa      ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ   SISTEMA   ‚îÇ
                   ‚îÇ Gera Laudo  ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ   CLIENTE   ‚îÇ
                   ‚îÇ Recebe Laudo‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 7.2 Arquitetura de Autentica√ß√£o

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Portal Web  ‚îÇ    ‚îÇ App Mobile  ‚îÇ    ‚îÇ Portal Cli  ‚îÇ
‚îÇ (Gestores)  ‚îÇ    ‚îÇ(Vistoriad.) ‚îÇ    ‚îÇ (Clientes)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚ñº                  ‚ñº                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                API BACKEND                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇAuth Portal  ‚îÇ ‚îÇ Auth App    ‚îÇ ‚îÇ Auth Client ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ/portal/login‚îÇ ‚îÇ /app/login  ‚îÇ ‚îÇ/client/login‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ SUPABASE    ‚îÇ
              ‚îÇ ‚Ä¢ portal_users
              ‚îÇ ‚Ä¢ app_users ‚îÇ
              ‚îÇ ‚Ä¢ clients   ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 7.3 Fluxo de Sincroniza√ß√£o (App Mobile)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ A√á√ÉO LOCAL  ‚îÇ
‚îÇ (Offline)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SQLITE      ‚îÇ
‚îÇ Cache Local ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SYNC QUEUE  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ NETWORK?    ‚îÇ
‚îÇ Fila Pend.  ‚îÇ    ‚îÇ Online?     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ Sim
                          ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ API SYNC    ‚îÇ
                   ‚îÇ Upload Data ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ SUPABASE    ‚îÇ
                   ‚îÇ Persist DB  ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ REALTIME    ‚îÇ
                   ‚îÇ Notify Web  ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä M√©tricas e Monitoramento

### Pontos de Monitoramento

- **API Response Time**: < 200ms para 95% das requisi√ß√µes
- **Sync Success Rate**: > 99% de sincroniza√ß√µes bem-sucedidas
- **Offline Capability**: App funcional por at√© 7 dias offline
- **File Upload Success**: > 98% de uploads de fotos bem-sucedidos
- **Authentication Success**: > 99.5% de logins bem-sucedidos

### Logs Importantes

- Tentativas de login falhadas
- Erros de sincroniza√ß√£o
- Falhas no upload de arquivos
- Viola√ß√µes de RLS (tentativas de acesso cross-tenant)
- Performance de queries lentas

---

**Documento criado em:** Janeiro 2025  
**Vers√£o:** 1.0  
**√öltima atualiza√ß√£o:** Janeiro 2025

---

*Este documento detalha todos os fluxos e processos do Sistema Grifo Vistorias. Para d√∫vidas t√©cnicas ou atualiza√ß√µes, consulte a equipe de desenvolvimento.*